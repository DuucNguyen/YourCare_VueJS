import{A as v}from"./ApiRole-nZgwNC8d.js";import{_ as $,r as f,k as F,j as C,z as j,o as q,c as k,b as c,a as n,w as o,d as p,f as u,g as h,F as P,e as b,t as D,h as E,C as R}from"./index-BuR_787K.js";const M={class:"main"},X={class:"crud-layout-header"},z={class:"main_body"},G={class:"claim_container"},H={class:"claim_item"},O={class:"claim_header"},Q={class:"claim_body"},J={__name:"update",setup(K){const V=F(),y=f(V.params.id);f([]);const L=f(),s=C({roleName:"",roleClaims:[]}),w={roleName:[{required:!0,message:"Vui lòng điền tên vai trò",trigger:"change"}],roleClaims:[{type:"array",required:!0,message:"Chọn ít nhất một quyền."}]},a=C({indeterminate:!1,isCheckedAll:!1,checkList_DoctorProfile:[],checkList_PatientProfile:[],checkList_User:[],checkList_Role:[],checkList_Specialty:[],checkList_TimeSlot:[],checkList_Timetable:[],checkList_All:[]}),l=[{name:"DoctorProfile",actions:["Create","View","Update","Delete"]},{name:"PatientProfile",actions:["Create","View","Update","Delete"]},{name:"User",actions:["Create","View","Update","Delete"]},{name:"Role",actions:["Create","View","Update","Delete"]},{name:"Specialty",actions:["Create","View","Update","Delete"]},{name:"TimeSlot",actions:["Create","View","Update","Delete"]},{name:"Timetable",actions:["Create","View","Update","Delete"]}],U=async()=>{var i=await v.GetRoleClaimByRoleID(y.value);if(i.data.isSucceeded){const t=i.data.data;s.roleClaims=t.map(e=>e.claimType),s.roleClaims&&(s.roleName=s.roleClaims[0].split("_")[0]),a.checkList_DoctorProfile=t.filter(e=>e.claimType.split("_")[1]==="DoctorProfile"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),a.checkList_PatientProfile=t.filter(e=>e.claimType.split("_")[1]==="PatientProfile"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),a.checkList_User=t.filter(e=>e.claimType.split("_")[1]==="DoctorProfile"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),a.checkList_DoctorProfile=t.filter(e=>e.claimType.split("_")[1]==="User"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),a.checkList_Role=t.filter(e=>e.claimType.split("_")[1]==="Role"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),a.checkList_TimeSlot=t.filter(e=>e.claimType.split("_")[1]==="TimeSlot"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),a.checkList_Timetable=t.filter(e=>e.claimType.split("_")[1]==="Timetable"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),a.checkList_Specialty=t.filter(e=>e.claimType.split("_")[1]==="Specialty"&&e.claimValue==="1").map(e=>e.claimType.split("_")[2]),console.log(a)}},S=i=>{Object.assign(a,{checkList_All:i.target.checked?l:[],checkList_DoctorProfile:i.target.checked?l.find(t=>t.name==="DoctorProfile").actions:[],checkList_PatientProfile:i.target.checked?l.find(t=>t.name==="PatientProfile").actions:[],checkList_User:i.target.checked?l.find(t=>t.name==="User").actions:[],checkList_Role:i.target.checked?l.find(t=>t.name==="Role").actions:[],checkList_Specialty:i.target.checked?l.find(t=>t.name==="Specialty").actions:[],checkList_TimeSlot:i.target.checked?l.find(t=>t.name==="TimeSlot").actions:[],checkList_Timetable:i.target.checked?l.find(t=>t.name==="Timetable").actions:[]})};j(()=>[...a.checkList_DoctorProfile,...a.checkList_PatientProfile,...a.checkList_Role,...a.checkList_User,...a.checkList_Specialty,...a.checkList_TimeSlot,...a.checkList_Timetable],i=>{var t=l.reduce((r,d)=>r+d.actions.length,0),e=i.length;a.isCheckedAll=e===t,a.indeterminate=e&&e<t,s.roleClaims=l.flatMap(r=>a[`checkList_${r.name}`].map(d=>`${s.roleName}_${r.name}_${d}`))});const g=i=>`checkList_${i}`,x=()=>{L.value.validate().then(async()=>{var i=new FormData;i.append("RoleID",y.value),s.roleClaims.forEach((e,r)=>{i.append(`RoleClaims[${r}]`,e)});var t=await v.UpdateRoleClaim(i);t.data.isSucceeded?R.success(t.data.message):R.error(t.data.message)}).catch(i=>{console.log(i)})};return q(async()=>{await U()}),(i,t)=>{const e=p("RouterLink"),r=p("a-input"),d=p("a-form-item"),T=p("a-checkbox"),A=p("a-checkbox-group"),N=p("a-button"),B=p("a-popconfirm"),I=p("a-form");return u(),k("div",M,[c("div",X,[t[3]||(t[3]=c("h2",{class:"crud-layout-header-title"},"Update Role",-1)),n(e,{class:"crud-layout-header-button",to:{name:"Admin_Role_View"}},{default:o(()=>t[2]||(t[2]=[h(" Index ")])),_:1})]),c("div",z,[n(I,{layout:"vertical",ref_key:"formRef",ref:L,model:s,rules:w},{default:o(()=>[n(d,{name:"roleName",label:"Tên vai trò mới"},{default:o(()=>[n(r,{readonly:"",value:s.roleName,"onUpdate:value":t[0]||(t[0]=m=>s.roleName=m),placeholder:"Tên vai trò"},null,8,["value"])]),_:1}),n(T,{class:"checkbox_all",checked:a.isCheckedAll,"onUpdate:checked":t[1]||(t[1]=m=>a.isCheckedAll=m),indeterminate:a.indeterminate,onChange:S},{default:o(()=>t[4]||(t[4]=[h("Check all")])),_:1},8,["checked","indeterminate"]),n(d,{name:"roleClaims",label:"Quyền truy cập"},{default:o(()=>[c("div",G,[(u(),k(P,null,b(l,m=>c("div",H,[c("div",O,[c("span",null,D(m.name),1)]),c("div",Q,[n(A,{class:"claim_group",value:a[g(m.name)],"onUpdate:value":_=>a[g(m.name)]=_},{default:o(()=>[(u(!0),k(P,null,b(m.actions,_=>(u(),E(T,{value:_},{default:o(()=>[h(D(_),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value"])])])),64))])]),_:1}),n(d,{class:"w-100 d-flex justify-content-end"},{default:o(()=>[n(B,{placement:"bottom","ok-text":"Xác nhận",okButtonProps:{type:"primary",style:{height:"30px",width:"150px"}},cancelButtonProps:{style:{height:"30px",width:"80px"}},"cancel-text":"Hủy",onConfirm:x},{title:o(()=>t[5]||(t[5]=[c("span",{class:"fs-6 text-primary"},"Xác nhận",-1),c("br",null,null,-1),c("span",{class:"text-danger"},"Vui lòng kiểm tra lại thông tin phía trên.",-1)])),default:o(()=>[n(N,{type:"primary",style:{height:"40px","font-weight":"500"},class:"w-100 fs-6"},{default:o(()=>t[6]||(t[6]=[h(" Lưu thay đổi ")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},Z=$(J,[["__scopeId","data-v-c66b15a1"]]);export{Z as default};
