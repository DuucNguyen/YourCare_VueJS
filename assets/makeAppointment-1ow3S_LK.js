import{r as f,j as ce,u as ve,L as fe,o as be,Q as he,c as b,a as l,w as i,d as p,F as C,k as ge,f as m,b as t,e as Y,O as V,t as d,q as _,y as u,g as x,h as _e,n as Q,p as ye,v as Se,s as xe,M as Ne,E as ke}from"./index-mrb-czRM.js";import{A as we}from"./ApiDoctorProfile-JojLMQMA.js";import{A as Te}from"./ApiTimetable-u9qNLIk5.js";import{A as F}from"./ApiPatientProfile-CRKCPGdk.js";import{A as De}from"./ApiAppointment-Ahq9HRGp.js";import{u as Ce}from"./route-store-BRdWV5F2.js";const He={class:"d-flex justify-content-between"},Me={class:"col-md-8",style:{"max-height":"350px"}},Ue={class:"profile-patient"},Ie={class:"profile-patient-title"},Ae={class:"w-100",id:"profile-patient-timeSlot"},Pe={class:"timeSlot-date-container"},Be=["id","onClick"],$e={key:0,class:"text-danger"},Ye={key:1},Ve={key:0,class:"w-100 alert alert-warning m-0"},Fe={key:1,class:"timeSlot-slot-container"},Le=["onClick"],Oe={key:1,class:"timeSlot-slot slot-unavailable"},qe={class:"mt-3 profile-patient"},Ge={class:"profile-patient-title"},Ee={class:"w-100",id:"profile-patient-profile"},je={class:"profile-container"},Re={class:"d-flex flex-column"},Xe=["id"],ze={class:"d-flex w-100"},Qe={class:"me-2"},Je=["value","id"],Ke=["for"],We={class:"profile-item-info"},Ze={class:"text-secondary"},et=["onClick"],tt=["id"],at={class:"profile-item-body-info"},nt={class:"profile-item-body-info"},lt={class:"profile-item-body-info"},ot={class:"profile-item-body-info"},it=["onClick"],st={class:"mt-3 appointment-info-item"},dt={class:"col-md-4 d-flex flex-column"},rt={class:"profile-doctor"},ut={class:"profile-doctor-info"},pt={style:{width:"80px",height:"80px"},class:"doctor-img"},mt=["src"],ct={class:"ms-3"},vt={class:"fs-5 m-0"},ft={style:{"font-weight":"500"}},bt={class:"fs-6 m-0"},ht={class:"profile-timetable-info"},gt={class:"info-row"},_t={class:"info-row"},yt={class:"info-row"},St={id:"appointmentPatientName"},Ht={__name:"makeAppointment",setup(xt){const H={create:"Tạo mới",update:"Chỉnh sửa"},N=f(!1),k=f(H.create),L=f(),o=ce({name:"",gender:!0,email:"",phoneNumber:"",address:"",dob:"",identityNumber:"",insuranceNumber:"",career:"",ethnic:""}),J={name:[{required:!0,message:"Vui lòng điền Họ và tên",trigger:"change"}],gender:[{required:!0,message:"Vui lòng chọn giới tính"}],phoneNumber:[{required:!0,message:"Vui lòng điền số điện thoại",trigger:"change"}],dob:[{required:!0,message:"Vui lòng chọn ngày tháng năm sinh",trigger:"change"}],address:[{required:!0,message:"Vui lòng điền địa chỉ",trigger:"change"}]},K=Ce(),O=ve();ge();const P=f([]),r=f({}),c=f({}),w=f({}),M=f([]),q=f([]),B=f([]),U=f(),G=f(),y=fe(()=>({doctorID:w.value.doctorProfileID??"",timetableID:c.value.id??"",timetableOrder:W(c.value.availableSlots),patientProfileID:r.value.id??"",patientNote:""})),W=n=>{switch(n){case 1:return 3;case 2:return 2;case 3:return 1}},E=()=>[...new Set(M.value.map(n=>n.startTime))].length,j=n=>{U.value=n,B.value=M.value.filter(e=>e.date===n)},R=(n,e)=>{var s=n.currentTarget.classList;n.currentTarget.classList.toggle("up"),s.contains("up")?n.currentTarget.innerHTML="<i class='bx bx-chevron-up'></i>":n.currentTarget.innerHTML="<i class='bx bx-chevron-down'></i>",$(e).slideToggle()},Z=n=>{c.value=n},ee=(n,e)=>{var s=$(e),v=$("#profileBody-"+n);s.hasClass("up")?s.innerHTML="<i class='bx bx-chevron-up'></i>":s.innerHTML="<i class='bx bx-chevron-down'></i>",v.slideToggle()},te=async()=>{var n=await Te.GetTimetableByDoctorID(c.value.doctorID??0);n.data.isSucceeded&&(M.value=n.data.data,q.value=[...new Map(M.value.map(e=>[e.date,e])).values()],j(c.value.date))},ae=async()=>{if(c.value){var n=await we.GetByID(c.value.doctorID);n.data.isSucceeded&&(w.value=n.data.data)}},ne=async()=>{var n=await O.getUserInfo(),e=await F.GetAllByUserID(n.id);e.data.isSucceeded&&(P.value=e.data.data,r.value=P.value[0])},le=n=>{r.value=n,k.value=H.update,N.value=!0,o.name=r.value.name??"",o.gender=r.value.gender??!0,o.phoneNumber=r.value.phoneNumber??"",o.address=r.value.address??"",o.dob=u(r.value.dob)??"",o.email=r.value.email??"",o.identityNumber=r.value.identityNumber??"",o.insuranceNumber=r.value.insuranceNumber??"",o.ethnic=r.value.ethnic??"",o.career=r.value.career??""},oe=n=>{L.value.validate().then(()=>{se(n)}).catch(e=>{console.log(e)})},ie=()=>{console.log(u(U.value));var n=u(U.value),e="YCA"+n.date().toString().padStart(2,"0")+(n.month()+1).toString().padStart(2,"0")+n.year()%100+u().minute().toString().padStart(2,"0")+u().second().toString().padStart(2,"0");return e},se=n=>{Ne.confirm({title:"Bạn có chắc chắn muốn thực hiện hành động này không ?",icons:l(ke),okText:"Đồng ý",cancelText:"Hủy",async onOk(){var e=await O.getUserInfo(),s=new FormData;s.append("gender",o.gender),s.append("name",o.name),s.append("address",o.address),s.append("applicationUserID",e.id),s.append("dob",o.dob),s.append("phoneNumber",o.phoneNumber),s.append("email",o.email),s.append("identityNumber",o.identityNumber),s.append("insuranceNumber",o.insuranceNumber),s.append("career",o.career),s.append("ethnic",o.ethnic);var v=null;n===H.create?v=await F.Create(s):(s.append("id",r.value.id),v=await F.Update(s));var T=v.data.isSucceeded?"success":"error",I=v.data.message;X(T,"Trạng thái hành động",I)}})},de=()=>{G.value.validate().then(async()=>{var n=new FormData;n.append("doctorID",y.value.doctorID),n.append("patientProfileID",y.value.patientProfileID),n.append("timetableID",y.value.timetableID),n.append("timetableOrder",y.value.timetableOrder),n.append("patientNote",y.value.patientNote);var e=ie();n.append("appointmentCode",e);var s=await De.Create(n),v=s.data.isSucceeded?"success":"error",T=s.data.message;X(v,"Trạng thái đặt khám",T)}).catch(n=>{console.log(n)})},X=(n,e,s)=>{xe[n]({message:e,description:s})};return be(async()=>{c.value=K.data,await ae(),await te(),await ne(),$("#profile-patient-timeSlot").hide(),he(()=>{$(".profile-item-body").each((n,e)=>{$(e).hide()})})}),(n,e)=>{const s=p("a-tooltip"),v=p("a-button"),T=p("a-popconfirm"),I=p("a-form"),re=p("a-divider"),S=p("a-input"),h=p("a-form-item"),g=p("a-col"),A=p("a-row"),ue=p("a-date-picker"),z=p("a-radio"),pe=p("a-radio-group"),me=p("a-modal");return m(),b(C,null,[l(I,{id:"form-appointment",ref_key:"createAppointmentForm",ref:G,model:y.value},{default:i(()=>[t("div",He,[t("div",Me,[t("div",Ue,[t("div",Ie,[e[19]||(e[19]=t("div",null,[t("span",null,"1"),t("span",null," - Ngày và giờ khám")],-1)),t("button",{onClick:e[0]||(e[0]=a=>R(a,"#profile-patient-timeSlot")),type:"button",class:"btn-slideToggle",id:"profile-patient-timeSlot-btn"},e[18]||(e[18]=[t("i",{class:"bx bx-chevron-down"},null,-1)]))]),t("div",Ae,[t("div",Pe,[(m(!0),b(C,null,Y(q.value,a=>(m(),b("div",{id:"timetb-"+a.id,class:V("timeSlot-date "+(U.value===a.date?"timeSlot-date-chosen":"")),onClick:D=>j(a.date)},[t("p",null,d(_(u)(a.date).format("dddd")),1),t("p",null,d(_(u)(a.date).date())+" - "+d(_(u)(a.date).month()+1),1),E(a.date)<=0?(m(),b("span",$e,"Đã đầy lịch")):(m(),b("span",Ye,d(E(a.date))+" khung giờ",1))],10,Be))),256))]),e[21]||(e[21]=t("div",{class:"timeSlot-slot-instructions"},[t("div",{class:"timeSlot-slot-instruction-item"},[t("div",{class:"timeSlot-available-chosen"},"#"),t("span",null,"-Đang chọn")]),t("div",{class:"timeSlot-slot-instruction-item"},[t("div",{class:"timeSlot-available-1"},"1"),t("span",null,"-Còn 01 chỗ trống")]),t("div",{class:"timeSlot-slot-instruction-item"},[t("div",{class:"timeSlot-available-2"},"2"),t("span",null,"-Còn 02 chỗ trống")]),t("div",{class:"timeSlot-slot-instruction-item"},[t("div",{class:"slot-unavailable"},"0"),t("span",null,"-Hết chỗ trống")])],-1)),t("div",null,[B.value.length<=0?(m(),b("p",Ve,e[20]||(e[20]=[t("span",{class:"d-flex align-items-center"},[t("span",{class:"me-2"},[t("i",{class:"fs-2 text-danger bx bx-error-circle"})]),x(" Lịch làm việc trong ngày này đã hết. Vui lòng chọn ngày khác. Xin cảm ơn !")],-1)]))):(m(),b("div",Fe,[(m(!0),b(C,null,Y(B.value,a=>(m(),b(C,null,[a.isAvailable?(m(),_e(s,{key:0,placement:"top"},{title:i(()=>[t("span",null,"Chỗ trống: "+d(a.availableSlots),1)]),default:i(()=>[t("div",{onClick:D=>Z(a),class:V(a.id===c.value.id?"timeSlot-slot timeSlot-chosen"+(a.availableSlots===1?" timeSlot-available-1":"")+(a.availableSlots===2?" timeSlot-available-2":""):"timeSlot-slot"+(a.availableSlots===1?" timeSlot-available-1":"")+(a.availableSlots===2?" timeSlot-available-2":""))},d(_(u)(a.startTime,"HH:mm:ss").format("HH:mm"))+" - "+d(_(u)(a.endTime,"HH:mm:ss").format("HH:mm")),11,Le)]),_:2},1024)):(m(),b("div",Oe,d(_(u)(a.startTime,"HH:mm:ss").format("HH:mm"))+" - "+d(_(u)(a.endTime,"HH:mm:ss").format("HH:mm")),1))],64))),256))]))])])]),t("div",qe,[t("div",Ge,[e[23]||(e[23]=t("div",null,[t("span",null,"2"),t("span",null," - Hồ sơ bệnh nhân")],-1)),t("button",{onClick:e[1]||(e[1]=a=>R(a,"#profile-patient-profile")),type:"button",id:"profile-patient-profile-btn",class:"btn-slideToggle up"},e[22]||(e[22]=[t("i",{class:"bx bx-chevron-up"},null,-1)]))]),t("div",Ee,[t("div",je,[(m(!0),b(C,null,Y(P.value,a=>(m(),b("div",Re,[t("div",{id:"profileHead-"+a.id,class:V("profile-item-head "+(r.value.id===a.id?"profile-item-head-chosen":""))},[t("div",ze,[t("div",Qe,[Q(t("input",{"onUpdate:modelValue":e[2]||(e[2]=D=>r.value=D),value:a,name:"patient-profile",type:"radio",class:"form-check-input",id:"profile-"+a.id},null,8,Je),[[ye,r.value]])]),t("label",{class:"d-flex w-100",for:"profile-"+a.id},[e[24]||(e[24]=t("div",{class:"profile-item-img"},[t("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/User-avatar.svg/2048px-User-avatar.svg.png"})],-1)),t("div",We,[t("span",null,d(a.name),1),t("span",Ze,d(a.dob!=null?_(u)(a.dob).format("DD/MM/YYYY"):""),1)])],8,Ke)]),t("div",null,[t("button",{type:"button",onClick:D=>ee(a.id,this),class:"btn-slideToggle-outline"},e[25]||(e[25]=[t("i",{class:"bx bx-chevron-down"},null,-1)]),8,et)])],10,Xe),t("div",{id:"profileBody-"+a.id,class:"profile-item-body"},[t("div",at,[e[26]||(e[26]=t("span",null,"Họ và tên",-1)),t("span",null,d(a.name!=null?a.name:"--"),1)]),t("div",nt,[e[27]||(e[27]=t("span",null,"Giới tính",-1)),t("span",null,d(a.gender==!0?"Nam":"Nữ"),1)]),t("div",lt,[e[28]||(e[28]=t("span",null,"Ngày sinh",-1)),t("span",null,d(a.dob!=null?_(u)(a.dob).format("DD/MM/YYYY"):""),1)]),t("div",ot,[e[29]||(e[29]=t("span",null,"Số điện thoại",-1)),t("span",null,d(a.phoneNumber!=null?a.phoneNumber:"--"),1)]),t("button",{type:"button",class:"btn-slideToggle-outline",id:"btn-update-profile",onClick:D=>le(a)}," Chỉnh sửa hồ sơ ",8,it)],8,tt)]))),256))])]),t("div",st,[e[30]||(e[30]=t("label",{for:"patientNote"},"Ghi chú của bệnh nhân: ",-1)),Q(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>y.value.patientNote=a),placeholder:"Thông tin bổ sung - VD: triệu chứng, bệnh lý, thuốc đang xử dung,..."},null,512),[[Se,y.value.patientNote]])]),t("div",null,[t("button",{onClick:e[4]||(e[4]=a=>{N.value=!0,k.value=H.create}),type:"button",title:"Tạo hồ sơ mới",class:"p-2 btn-slideToggle"},e[31]||(e[31]=[x(" Thêm hồ sơ mới "),t("i",{class:"bx bx-user-plus"},null,-1)]))])])]),t("div",dt,[t("div",rt,[e[38]||(e[38]=t("div",{class:"d-flex align-items-start"},[t("h5",null,"Thông tin đặt khám")],-1)),t("div",ut,[t("div",pt,[t("img",{src:w.value.imageString,alt:"avatar"},null,8,mt)]),t("div",ct,[t("p",vt,[e[32]||(e[32]=x(" Bác sĩ ")),t("span",ft,d(w.value.fullName),1)]),t("p",bt,d(w.value.doctorTitle),1)])]),t("div",ht,[t("div",gt,[e[33]||(e[33]=t("span",null,"Ngày khám",-1)),t("span",null,d(_(u)(c.value.date).format("DD/MM/YYYY")),1)]),t("div",_t,[e[34]||(e[34]=t("span",null,"Ca khám",-1)),t("span",null,d(c.value.startTime)+" - "+d(c.value.endTime),1)]),t("div",yt,[e[35]||(e[35]=t("span",null,"Bệnh nhân",-1)),t("span",St,d(r.value.name),1)])]),l(T,{placement:"bottom","ok-text":"Xác nhận đặt khám",okButtonProps:{type:"primary",style:{height:"30px",width:"150px"}},cancelButtonProps:{style:{height:"30px",width:"80px"}},"cancel-text":"Hủy",onConfirm:de},{title:i(()=>e[36]||(e[36]=[t("span",{class:"fs-6 text-primary"},"Xác nhận đặt khám online",-1),t("br",null,null,-1),t("span",{class:"text-danger"},"Vui lòng kiểm tra lại thông tin đặt khám phía trên.",-1)])),default:i(()=>[l(v,{type:"primary",style:{height:"40px","font-weight":"500"},class:"w-100 fs-6"},{default:i(()=>e[37]||(e[37]=[x("Đặt khám")])),_:1})]),_:1})])])])]),_:1},8,["model"]),l(me,{width:"800px",title:k.value+" hồ sơ bệnh nhân ",open:N.value,"onUpdate:open":e[17]||(e[17]=a=>N.value=a),centered:""},{footer:i(()=>[l(v,{key:"cancel",onClick:e[15]||(e[15]=a=>N.value=!1)},{default:i(()=>e[41]||(e[41]=[x("Hủy")])),_:1}),l(v,{key:"submit",type:"primary",onClick:e[16]||(e[16]=a=>oe(k.value))},{default:i(()=>[x(d(k.value),1)]),_:1})]),default:i(()=>[l(re),l(I,{layout:"vertical",model:o,rules:J,ref_key:"createForm",ref:L},{default:i(()=>[l(A,{gutter:24},{default:i(()=>[l(g,{span:12},{default:i(()=>[l(h,{label:"Họ và tên",name:"name"},{default:i(()=>[l(S,{placeholder:"Họ và tên bệnh nhân",value:o.name,"onUpdate:value":e[5]||(e[5]=a=>o.name=a)},null,8,["value"])]),_:1})]),_:1}),l(g,{span:12},{default:i(()=>[l(h,{label:"Số điện thoại",name:"phoneNumber"},{default:i(()=>[l(S,{placeholder:"SĐT",value:o.phoneNumber,"onUpdate:value":e[6]||(e[6]=a=>o.phoneNumber=a)},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(A,{gutter:24},{default:i(()=>[l(g,{span:12},{default:i(()=>[l(h,{label:"Ngày sinh",name:"dob"},{default:i(()=>[l(ue,{placeholder:"Ngày tháng năm sinh",style:{width:"100%"},value:o.dob,"onUpdate:value":e[7]||(e[7]=a=>o.dob=a)},null,8,["value"])]),_:1})]),_:1}),l(g,{span:12},{default:i(()=>[l(h,{label:"Giới tính",name:"gender"},{default:i(()=>[l(pe,{value:o.gender,"onUpdate:value":e[8]||(e[8]=a=>o.gender=a)},{default:i(()=>[l(z,{value:!0},{default:i(()=>e[39]||(e[39]=[x("Nam")])),_:1}),l(z,{value:!1},{default:i(()=>e[40]||(e[40]=[x("Nữ")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),l(A,{gutter:24},{default:i(()=>[l(g,{span:8},{default:i(()=>[l(h,{label:"Email",name:"email"},{default:i(()=>[l(S,{placeholder:"Đại chỉ email bệnh nhân",value:o.email,"onUpdate:value":e[9]||(e[9]=a=>o.email=a)},null,8,["value"])]),_:1})]),_:1}),l(g,{span:8},{default:i(()=>[l(h,{label:"Địa chỉ",name:"address"},{default:i(()=>[l(S,{placeholder:"Địa chỉ nơi ở cụ thể",value:o.address,"onUpdate:value":e[10]||(e[10]=a=>o.address=a)},null,8,["value"])]),_:1})]),_:1}),l(g,{span:8},{default:i(()=>[l(h,{label:"Nghề nghiệp",name:"career"},{default:i(()=>[l(S,{placeholder:"Nghề nghiệp hiện tại",value:o.career,"onUpdate:value":e[11]||(e[11]=a=>o.career=a)},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(A,{gutter:24},{default:i(()=>[l(g,{span:8},{default:i(()=>[l(h,{label:"Số CMND/CCCD",name:"identityNumber"},{default:i(()=>[l(S,{placeholder:"Số CMND hoặc CCCD",value:o.identityNumber,"onUpdate:value":e[12]||(e[12]=a=>o.identityNumber=a)},null,8,["value"])]),_:1})]),_:1}),l(g,{span:8},{default:i(()=>[l(h,{label:"Số BHYT",name:"insuranceNumber"},{default:i(()=>[l(S,{placeholder:"Mã số trên thẻ bảo hiểm y tế",value:o.insuranceNumber,"onUpdate:value":e[13]||(e[13]=a=>o.insuranceNumber=a)},null,8,["value"])]),_:1})]),_:1}),l(g,{span:8},{default:i(()=>[l(h,{label:"Dân tộc",name:"ethnic"},{default:i(()=>[l(S,{placeholder:"Dân tộc",value:o.ethnic,"onUpdate:value":e[14]||(e[14]=a=>o.ethnic=a)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","open"])],64)}}};export{Ht as default};
