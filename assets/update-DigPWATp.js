import{r as f,j as Y,k as z,o as E,c as j,b as m,a as o,w as l,d as u,F as G,A as U,y as N,f as $,g as c,q as H,M as J,E as K,s as Q}from"./index-q7kJcf_g.js";import{P as W}from"./PlusOutlined-DyZu3lXI.js";const X={class:"crud-layout-header"},Z={class:"crud-layout-form"},ee=["src"],h="YYYY/MM/DD",le={__name:"update",setup(ae){const F=z(),g=f(),k={span:4},x={span:24},t=Y({userID:F.params.id||"",fullName:"",email:"",phoneNumber:"",address:"",gender:!0,dob:"",image:[]}),C={fullName:[{required:!0,message:"Please input user full name",trigger:"change"}],email:[{required:!0,message:"Please input user email",trigger:"change"},{type:"email",message:"Please input valid email format (@gmail.com/@...com).",trigger:"change"}],dob:[{required:!0,message:"Please input user date of birth.",trigger:"change"}],image:[{required:!0,type:"array",message:"Please upload at least one image."}],gender:[{required:!0,message:"Please choose at least one gender."}]},P=async()=>{var e=await U.GetByID(t.userID);e.data.isSucceeded&&(t.fullName=e.data.data.fullName,t.email=e.data.data.email,t.phoneNumber=e.data.data.phoneNumber,t.address=e.data.data.address,t.gender=e.data.data.gender,t.dob=N(e.data.data.dob.split("T")[0],h),t.image.push({id:"-1",name:"applicationUserImage",status:"done",thumbUrl:e.data.data.imageString}))};E(async()=>{await P()});const D=()=>{g.value.validate().then(()=>{I()}).catch(e=>{console.log(e)})},A=()=>{g.value.resetFields()},I=()=>{J.confirm({title:"Update confirmation",icon:o(K),content:"Are you sure to update this user information ?",okText:"Yes",cancelText:"No",async onOk(){const e=new FormData;e.append("image",L(t.image[0].thumbUrl,"applicationImage")),e.append("id",t.userID),e.append("fullName",t.fullName),e.append("email",t.email),e.append("phoneNumber",t.phoneNumber),e.append("address",t.address),e.append("dob",N(t.dob).format(h)),e.append("gender",t.gender);const a=await U.Update(e),r=a.data.isSucceeded?"success":"error",d=a.data.message;B(r,"Update status",d)},onCancel(){console.log("Cancel update")}})},B=(e,a,r)=>{Q[e]({message:a,description:r})},R=e=>e.size>2097152?(this.$message.error("File size muse be less than 2mb."),!1):!0;function L(e,a="file.png"){const r=atob(e.split(",")[1]),d=e.match(/data:(.*?);base64/)[1],p=new ArrayBuffer(r.length),s=new Uint8Array(p);for(let i=0;i<r.length;i++)s[i]=r.charCodeAt(i);return new File([s],a,{type:d})}const b=f(!1),_=f(""),v=f("");function T(e){return new Promise((a,r)=>{const d=new FileReader;d.readAsDataURL(e),d.onload=()=>a(d.result),d.onerror=p=>r(p)})}const q=async e=>{!e.thumbUrl&&!e.preview&&(e.preview=await T(e.originFileObj)),_.value=e.thumbUrl||e.preview,b.value=!0,v.value=e.name||e.thumbUrl.substring(e.thumbUrl.lastIndexOf("/")+1)},M=()=>{b.value=!1,v.value=""};return(e,a)=>{const r=u("RouterLink"),d=u("a-upload"),p=u("a-modal"),s=u("a-form-item"),i=u("a-input"),S=u("a-date-picker"),y=u("a-radio"),O=u("a-radio-group"),w=u("a-button"),V=u("a-form");return $(),j(G,null,[m("div",X,[a[8]||(a[8]=m("h2",{class:"crud-layout-header-title"},"Update User",-1)),o(r,{class:"crud-layout-header-button",to:{name:"Admin_User_View"}},{default:l(()=>a[7]||(a[7]=[c("Back to Lists")])),_:1})]),m("div",Z,[o(V,{ref_key:"formRef",ref:g,model:t,rules:C,"label-col":k,"wrapper-col":x},{default:l(()=>[o(s,{class:"mb-5",label:"Image",name:"image"},{default:l(()=>[o(d,{fileList:t.image,"onUpdate:fileList":a[0]||(a[0]=n=>t.image=n),action:"/upload.do","list-type":"picture-card",maxCount:1,beforeUpload:R,onPreview:q},{default:l(()=>[m("div",null,[o(H(W)),a[9]||(a[9]=m("div",{style:{"margin-top":"8px"}},"Upload",-1))])]),_:1},8,["fileList"]),o(p,{open:b.value,title:v.value,footer:null,onCancel:M},{default:l(()=>[m("img",{alt:"example",style:{width:"100%"},src:_.value},null,8,ee)]),_:1},8,["open","title"])]),_:1}),o(s,{label:"FullName",name:"fullName"},{default:l(()=>[o(i,{value:t.fullName,"onUpdate:value":a[1]||(a[1]=n=>t.fullName=n)},null,8,["value"])]),_:1}),o(s,{label:"Email",name:"email"},{default:l(()=>[o(i,{value:t.email,"onUpdate:value":a[2]||(a[2]=n=>t.email=n)},null,8,["value"])]),_:1}),o(s,{label:"Phone",name:"phoneNumber"},{default:l(()=>[o(i,{value:t.phoneNumber,"onUpdate:value":a[3]||(a[3]=n=>t.phoneNumber=n)},null,8,["value"])]),_:1}),o(s,{label:"Date of birth",name:"dob"},{default:l(()=>[o(S,{value:t.dob,"onUpdate:value":a[4]||(a[4]=n=>t.dob=n),placeholder:"Pick a date",style:{width:"100%"}},null,8,["value"])]),_:1}),o(s,{label:"Gender",name:"gender"},{default:l(()=>[o(O,{value:t.gender,"onUpdate:value":a[5]||(a[5]=n=>t.gender=n)},{default:l(()=>[o(y,{value:!0},{default:l(()=>a[10]||(a[10]=[c("Male")])),_:1}),o(y,{value:!1},{default:l(()=>a[11]||(a[11]=[c("Female")])),_:1})]),_:1},8,["value"])]),_:1}),o(s,{label:"Address",name:"address"},{default:l(()=>[o(i,{value:t.address,"onUpdate:value":a[6]||(a[6]=n=>t.address=n)},null,8,["value"])]),_:1}),o(s,{"wrapper-col":{span:24,offset:10}},{default:l(()=>[o(w,{type:"primary",onClick:D},{default:l(()=>a[12]||(a[12]=[c("Update")])),_:1}),o(w,{style:{"margin-left":"10px"},onClick:A},{default:l(()=>a[13]||(a[13]=[c("Reset")])),_:1})]),_:1})]),_:1},8,["model"])])],64)}}};export{le as default};
