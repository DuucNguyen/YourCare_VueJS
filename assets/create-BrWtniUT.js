import{D as X}from"./DoctorSideBar-DeFA-XQK.js";import{A as T}from"./ApiAppointment-DT-DO1hC.js";import{A as $}from"./ApiTimetable-DE_LnU9n.js";import{A as j}from"./ApiPatientProfile-Dtyk9GTO.js";import{u as q,r as d,L as z,o as E,c as l,a as w,b as t,N as J,F as k,e as H,g as N,t as o,q as r,y as i,w as h,d as x,k as K,C as P,m as Q,f as n,O as A,h as W,s as Z}from"./index-SWlYOb7A.js";import{u as tt}from"./route-store-DsiDn0_s.js";/* empty css                                                                      */const et={class:"doctor_dashboard_body"},at={class:"doctor_dashboard_section"},st={class:"d-flex justify-content-between"},ot={class:"col-md-8",style:{"max-height":"350px"}},it={class:"profile-patient"},nt={class:"w-100",id:"profile-patient-timeSlot"},lt={class:"timeSlot-date-container"},rt=["id","onClick"],dt={key:0,class:"text-danger"},pt={key:1},ct={key:0,class:"w-100 alert alert-warning m-0"},mt={key:1,class:"timeSlot-slot-container"},ut=["onClick"],vt={key:1,class:"timeSlot-slot slot-unavailable"},ht={class:"col-md-4 d-flex flex-column"},ft={class:"profile-doctor"},_t={class:"profile-timetable-info"},bt={class:"info-row"},St={id:"appointmentPatientName"},gt={class:"info-row"},yt={id:"appointmentPatientName"},Dt={class:"info-row"},wt={id:"appointmentPatientName"},kt={class:"info-row"},xt={id:"appointmentPatientName"},It={class:"profile-timetable-info"},Ct={class:"info-row"},Tt={class:"info-row"},Mt={__name:"create",setup(Ht){q(),tt(),Q();const B=K(),_=d(0),m=d({}),f=d([]),b=d([]),S=d([]),g=d(),p=d({}),u=d({}),c=z(()=>({doctorID:m.value.doctorID,patientProfileID:m.value.patientProfileID,timetableID:p.value.id,timetableOrder:Y(p.value.availableSlots),isFollowUp:!0,previousAppointmentID:m.value.id})),I=()=>[...new Set(f.value.map(a=>a.startTime))].length,C=a=>{g.value=a,S.value=f.value.filter(e=>e.date===a)},F=a=>{p.value=a},Y=a=>{switch(a){case 1:return 3;case 2:return 2;case 3:return 1}},V=async()=>{_.value=B.params.id,_.value||P.error("Failed to get appointment info");var a=await T.GetDetailById(_.value);a.data.isSucceeded&&(m.value=a.data.data)},M=async()=>{var a=await $.GetTimetableByDoctorID(m.value.doctorID??0);a.data.isSucceeded&&(f.value=a.data.data,b.value=[...new Map(f.value.map(e=>[e.date,e])).values()],C(b.value[0].date))},O=async()=>{var a=await j.GetByID(m.value.patientProfileID);a.data.isSucceeded&&(u.value=a.data.data)},G=()=>{var a=i(g.value),e="YCA"+a.date().toString().padStart(2,"0")+(a.month()+1).toString().padStart(2,"0")+a.year()%100+i().minute().toString().padStart(2,"0")+i().second().toString().padStart(2,"0");return e},L=async()=>{if(!c.value.timetableID){P.error("Vui lòng chọn lịch khám");return}var a=new FormData;a.append("doctorID",c.value.doctorID),a.append("patientProfileID",c.value.patientProfileID),a.append("timetableID",c.value.timetableID),a.append("timetableOrder",c.value.timetableOrder),a.append("isFollowUp",c.value.isFollowUp),a.append("previousAppointmentID",c.value.previousAppointmentID);var e=G();a.append("appointmentCode",e);var v=await T.Create(a),y=v.data.isSucceeded?"success":"error",D=v.data.message;R(y,"Trạng thái đặt khám",D)},R=(a,e,v)=>{Z[a]({message:e,description:v})};return E(async()=>{await V(),await M(),await O()}),(a,e)=>{const v=x("a-tooltip"),y=x("a-button"),D=x("a-popconfirm");return n(),l("div",et,[w(X,{"active-item":"appointment"}),t("div",at,[e[12]||(e[12]=t("div",{class:"doctor_dashboard_title"},[t("h3",{class:"mb-3 mt-1"},"Đặt lịch tái khám")],-1)),t("div",st,[t("div",ot,[t("div",it,[e[2]||(e[2]=t("div",{class:"profile-patient-title"},[t("div",null,[t("span",null,"#"),t("span",null," - Ngày và giờ khám")])],-1)),t("div",nt,[t("div",lt,[(n(!0),l(k,null,H(b.value,s=>(n(),l("div",{id:"timetb-"+s.id,class:A("timeSlot-date "+(g.value===s.date?"timeSlot-date-chosen":"")),onClick:U=>C(s.date)},[t("p",null,o(r(i)(s.date).format("dddd")),1),t("p",null,o(r(i)(s.date).date())+" - "+o(r(i)(s.date).month()+1),1),I(s.date)<=0?(n(),l("span",dt,"Đã đầy lịch")):(n(),l("span",pt,o(I(s.date))+" khung giờ",1))],10,rt))),256))]),e[1]||(e[1]=J('<div class="timeSlot-slot-instructions"><div class="timeSlot-slot-instruction-item"><div class="timeSlot-available-chosen">#</div><span>-Đang chọn</span></div><div class="timeSlot-slot-instruction-item"><div class="timeSlot-available-1">1</div><span>-Còn 01 chỗ trống</span></div><div class="timeSlot-slot-instruction-item"><div class="timeSlot-available-2">2</div><span>-Còn 02 chỗ trống</span></div><div class="timeSlot-slot-instruction-item"><div class="slot-unavailable">0</div><span>-Hết chỗ trống</span></div></div>',1)),t("div",null,[S.value.length<=0?(n(),l("p",ct,e[0]||(e[0]=[t("span",{class:"d-flex align-items-center"},[t("span",{class:"me-2"},[t("i",{class:"fs-2 text-danger bx bx-error-circle"})]),N(" Lịch làm việc trong ngày này đã hết. Vui lòng chọn ngày khác. Xin cảm ơn ! ")],-1)]))):(n(),l("div",mt,[(n(!0),l(k,null,H(S.value,s=>(n(),l(k,null,[s.isAvailable?(n(),W(v,{key:0,placement:"top"},{title:h(()=>[t("span",null,"Chỗ trống: "+o(s.availableSlots),1)]),default:h(()=>[t("div",{onClick:U=>F(s),class:A(s.id===p.value.id?"timeSlot-slot timeSlot-chosen"+(s.availableSlots===1?" timeSlot-available-1":"")+(s.availableSlots===2?" timeSlot-available-2":""):"timeSlot-slot"+(s.availableSlots===1?" timeSlot-available-1":"")+(s.availableSlots===2?" timeSlot-available-2":""))},o(r(i)(s.startTime,"HH:mm:ss").format("HH:mm"))+" - "+o(r(i)(s.endTime,"HH:mm:ss").format("HH:mm")),11,ut)]),_:2},1024)):(n(),l("div",vt,o(r(i)(s.startTime,"HH:mm:ss").format("HH:mm"))+" - "+o(r(i)(s.endTime,"HH:mm:ss").format("HH:mm")),1))],64))),256))]))])])])]),t("div",ht,[t("div",ft,[e[11]||(e[11]=t("div",{class:"d-flex align-items-start"},[t("h5",null,"Thông tin tái khám")],-1)),t("div",_t,[t("div",bt,[e[3]||(e[3]=t("span",null,"Bệnh nhân",-1)),t("span",St,o(u.value.name),1)]),t("div",gt,[e[4]||(e[4]=t("span",null,"Giới tính",-1)),t("span",yt,o(u.value.gender?"Nam":"Nữ"),1)]),t("div",Dt,[e[5]||(e[5]=t("span",null,"Ngày sinh",-1)),t("span",wt,o(u.value.dob?r(i)(u.value.dob).format("DD/MM/YYYY"):"Chưa cập nhật"),1)]),t("div",kt,[e[6]||(e[6]=t("span",null,"SĐT",-1)),t("span",xt,o(u.value.phoneNumber??"Chưa cập nhật"),1)])]),t("div",It,[t("div",Ct,[e[7]||(e[7]=t("span",null,"Ngày khám",-1)),t("span",null,o(r(i)(p.value.date).format("DD/MM/YYYY")),1)]),t("div",Tt,[e[8]||(e[8]=t("span",null,"Ca khám",-1)),t("span",null,o(p.value.startTime)+" - "+o(p.value.endTime),1)])]),w(D,{placement:"bottom","ok-text":"Xác nhận",okButtonProps:{type:"primary",style:{height:"30px",width:"150px"}},cancelButtonProps:{style:{height:"30px",width:"80px"}},"cancel-text":"Hủy",onConfirm:L},{title:h(()=>e[9]||(e[9]=[t("span",{class:"fs-6 text-primary"},"Xác nhận đặt lịch tái khám ",-1),t("br",null,null,-1),t("span",{class:"text-danger"}," Vui lòng kiểm tra lại thông tin đặt khám phía trên. ",-1)])),default:h(()=>[w(y,{type:"primary",style:{height:"40px","font-weight":"500"},class:"w-100 fs-6"},{default:h(()=>e[10]||(e[10]=[N("Đặt lịch tái khám ")])),_:1})]),_:1})])])])])])}}};export{Mt as default};
